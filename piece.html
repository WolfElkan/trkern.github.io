<!DOCTYPE html>
<html>
<head>
<script src="math.min.js" type="text/javascript"></script>
<script src="d3.min.js" type="text/javascript"></script>
<script src="function-plot.js" type="text/javascript"></script>
<script src="katex.min.js" type="text/javascript"></script>
<link rel="stylesheet" href="katex.min.css">
<script>
var funs = [];
var lbounds = [];
var ubounds = [];
var styles = [];
var lcmp = ["","","","","<","≤","<","≤","<","≤"];
var ucmp = ["=","≠","<","≤","<","<","≤","≤","",""];
var cmps = ["x = a","x ≠ a","x < a","x ≤ a","a < x < b","a ≤ x < b","a < x ≤ b","a ≤ x ≤ b","a < x","a ≤ x"];
var globn = 0;
var fillpts = [];
var holepts = [];
function rowi(i) {
	//returns a string representing row i. if row i isn't in the (funs) table so far, adds it.
	if (!(i in funs)) {
		funs[i] = "";
		lbounds[i] = "0";
		ubounds[i] = "0";
		styles[i] = 6;
		}
	var strng = "<tr>";
	strng += "<td> <input type='textbox' id='fun"+i+"' onChange='Upds()' style='width:20em' value='"+ funs[i] + "'> </td>";
	strng += "<td> If </td>";
	if (styles[i] >= 4) {
		strng += "<td> <input type='number' id='low"+i+"' onChange='Upds()' style='width:3em' value='"+ lbounds[i] + "'> </td>";
		strng += "<td>" + lcmp[styles[i]] + "</td>";
		} else {
		strng += "<td> </td> <td> </td>";
		}
	strng += "<td> x </td>";
	if (styles[i] <= 7) {
		strng += "<td>" + ucmp[styles[i]] + "</td>";
		strng += "<td> <input type='number' id='high"+i+"' onChange='Upds()' style='width:3em' value='"+ ubounds[i] + "'> </td>";
		} else {
		strng += "<td> </td> <td> </td>";		
		}
	strng += "<td style='width:100px'> </td>";
	strng += "<td> <select onChange='Upds()' id='sel" + i + "'>";
	var j = 0;
	for (j = 0; j < 10; j++) {
		if (j == styles[i]) {
			strng += "<option selected value=" + j + ">" + cmps[j] + "</option>";
			} else {
			strng += "<option value=" + j + ">" + cmps[j] + "</option>";
			}
		}
	strng += "</select>";
	return(strng);
	}
function Updn() {
	var n = Number(document.getElementById("n").value);
	globn = n;
	Updt();
	}
function Updt() {
	var n = globn;
	document.getElementById("n").value = n;
	var strng = "<table border=0> <tr> <td style='valign:middle'> f(x) = </td> <td> <p id='curly' style='transform:scale(1,"+(1.7*n)+") translateY(-1.1px)'> { </p> </td> <td> <table border = 0>";
	for (i = 0; i < n; i++) {
		strng += rowi(i);
		}
	strng += "</table> </td> </tr> </table>";
	document.getElementById("inputs").innerHTML = strng;
	Updg();
	}
function Upds() {
	var i = 0;
	var n = globn;
	for (i = 0; i < n; i++) {
		funs[i] = document.getElementById("fun" + i).value;
		if (styles[i] >= 4) {
			lbounds[i] = document.getElementById("low" + i).value;
			}
		if (styles[i] <= 7) {
			ubounds[i] = document.getElementById("high" + i).value;
			}
		styles[i] = document.getElementById("sel" + i).value;
		}
	Updn();
	}
function loadabs() {
	globn = 2;
	funs = ["-x","x"];
	lbounds = [0,0];
	ubounds = [0,0];
	styles = [2,9];
	Updt();
	}

function loadface() {
	globn = 7;
	funs = ["4*sqrt(1-(x/4)^2)", "-4*sqrt(1-(x/4)^2)", "1.5", "1.5", "2*x", "-.5", "((x/2)^2)-2.5"];
	lbounds = [-4, -4, 0, 0, -.25, -.25, -2];
	ubounds = [4, 4, -1.5, 1.5, .25, .25, 2];
	styles = [7, 6, 0, 0, 7, 6, 6];
	Updt();
	}

function loadex1() {
	globn = 2;
	funs = ["-(x/2)", "2*x + 1"];
	lbounds = [0,-1];
	ubounds = [-1,0];
	styles = [2,9];
	Updt();
	}

function loadex2() {
	globn = 3;
	funs = ["-2*x-1", "x^2", "2"];
	lbounds = [0,-1,2];
	ubounds = [-1,2,0];
	styles = [2,7,8];
	Updt();
	}

function loadex3() {
	globn = 3;
	funs = ["-(x^2) + 1","0","x^2 - 1"];
	lbounds = [0,0,0];
	ubounds = [0,0,0];
	styles = [2,0,8];
	Updt();
	}

function loadex4() {
	globn = 3;
	funs = ["x+2", "1", "-2*x+3"];
	lbounds = [0,-1,1];
	ubounds = [-1,1,0];
	styles = [2,5,9];
	Updt();
	}

function loadex5() {
	globn = 1;
	funs = ["1/(x+1)"];
	lbounds = [0];
	ubounds = [-2];
	styles = [1];
	Updt();
	}

function loadex6() {
	globn = 4;
	funs = ["sin(x)", "-(2*x^3)", "0", "sqrt(x)"];
	lbounds = [0,-1,0,1];
	ubounds = [-1,1,1,0];
	styles = [3,4,0,8];
	Updt();
	}

function tograph(x,mn,mx) {
	var m = -500/(mn-mx);
	var b = 500*mn/(mn-mx);
	return(m*x+b);
	}


function ineq(i) {
	if (styles[i] == 0) {
		return("x = " + ubounds[i]);
		}
	if (styles[i] == 1) {
		return("x \\neq " + ubounds[i]);
		}
	if (styles[i] == 2) {
		return("x < " + ubounds[i]);
		}
	if (styles[i] == 3) {
		return("x \\leq " + ubounds[i]);
		}
	if (styles[i] == 4) {
		return(lbounds[i] + "< x <" + ubounds[i]);
		}
	if (styles[i] == 5) {
		return(lbounds[i] + "\\leq x <" + ubounds[i]);
		}
	if (styles[i] == 6) {
		return(lbounds[i] + "< x \\leq" + ubounds[i]);
		}
	if (styles[i] == 7) {
		return(lbounds[i] + "\\leq x \\leq" + ubounds[i]);
		}
	if (styles[i] == 8) {
		return(lbounds[i] + "< x");
		}
	if (styles[i] == 9) {
		return(lbounds[i] + "\\leq x");
		}
	}

function makekatex() {
	var str = "f(x) = \\begin{cases}";
	for (i = 0; i < globn; i++) {
		str += math.parse(funs[i]).toTex();
		str += "&";
		str += ineq(i);
		str += "\\\\";
		}
	str += "\\end{cases}";
	katex.render(str,document.getElementById("tex"));
	}

function plugin(v,eq) {
	var a = math.eval(eq,{x:v});
	console.log(a);
	return(a);
	}

//var cmps = ["0x = a","1x ≠ a","2x < a","3x ≤ a","4a < x < b","5a ≤ x < b","6a < x ≤ b","7a ≤ x ≤ b","8a < x","9a ≤ x"];
function Updg() {
	var eps = .001;
	document.getElementById("grp").innerHTML = "";
	var dlist = [];
	var i;
	var u, l;
	fillpts=[];
	holepts=[];
	for (i = 0; i < globn; i++) {
		if (funs[i] == "") {continue;}
		if (styles[i] >= 4 && styles[i] <= 7 && lbounds[i] > ubounds[i]) {continue;}
		l = -Infinity;
		u = Infinity;
		if (styles[i] >= 4) {l = lbounds[i];}
		if (styles[i] <= 7) {u = ubounds[i];}
		if (styles[i] >= 4) {
			if (styles[i]%2 == 1) {
				fillpts.push([lbounds[i],plugin(lbounds[i],funs[i])]);
				}
			else {
				l = +l+.001;
				holepts.push([lbounds[i],plugin(lbounds[i],funs[i])]);
				}
			}
		if (styles[i] <= 7) {
			if (styles[i] == 0 || styles[i] == 3 || styles[i] == 6 || styles[i] == 7) {
				fillpts.push([ubounds[i],plugin(ubounds[i],funs[i])]);
				}
			else {
				u = +u-.001;
				holepts.push([ubounds[i],plugin(ubounds[i],funs[i])]);
				}
			}
		if (styles[i] == 0) {l = +ubounds[i]-.0000001; u = +ubounds[i]+.0000001;}
		if (styles[i] == 1) {l = -Infinity; u = Infinity;}
		dlist.push({
			fn: funs[i],
			range: [l,u],
			color: "black"
			});
		}

	console.log(dlist);

	var newholepts = [];
	var newfillpts = [];
	var bl = 0;
	
	for (i = 0; i < holepts.length; i++) {
		bl = 0;
		for (j = 0; j < fillpts.length; j++) {
			if ((holepts[i][0] == fillpts[j][0]) && (holepts[i][1] == fillpts[j][1])) {bl = 1;}
			}
		if (bl == 0) {newholepts.push(holepts[i]);}
		}
	
	for (j = 0; j < fillpts.length; j++) {
		bl = 0;
		for (i = 0; i < holepts.length; i++) {
			if ((holepts[i][0] == fillpts[j][0]) && (holepts[i][1] == fillpts[j][1])) {bl = 1;}
			}
		if (bl == 0) {newfillpts.push(fillpts[j]);}
		}

	dlist.push({
		fnType: "points",
		graphType: "scatter",
		points: newholepts,
		color:"black",
		attr: {r:5, fill:'rgba(255,255,255,1)', stroke:"black", "stroke-width":2, "opacity":1}
		});
	dlist.push({
		fnType: "points",
		graphType: "scatter",
		points: newfillpts,
		color:"black",
		attr: {r:5, fill:"black", "opacity":1}
		});
	var b = functionPlot({target: '#grp', data: dlist, tip: {xLine:true, yLine:true},
		grid: true,
		width: 500,
		height: 500,});
	makekatex();
	}

</script>
</head>
<body onload="Updn()">
<button onclick="loadabs()"> Abs(x) </button>
<button onclick="loadex1()"> Example 1 </button>
<button onclick="loadex2()"> Example 2 </button> 
<button onclick="loadex3()"> Example 3 </button>
<button onclick="loadex4()"> Example 4 </button>
<button onclick="loadex5()"> Example 5 </button> 
<button onclick="loadex6()"> Example 6 </button> 
<button onclick="loadface()"> Face </button> <br>
Number of Pieces: <input type="number" id="n" oninput="Updn()" value=1 style="width:4em">
<span id="inputs"> </span>
<div id="grp"> </div> <span id="tex"> </span>
</body>
</html>