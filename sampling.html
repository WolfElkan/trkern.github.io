<!DOCTYPE html>
<html>
<head>
<script>
var total = 0;
var trials = 0;
function ribet(mn,mx) {
	return(Math.floor(Math.random()*(mx-mn+1))+mn);
	}
function randn_bm() { //stolen from stackexchange
	var u = 0, v = 0;
	while(u === 0) u = Math.random();
	while(v === 0) v = Math.random();
	return Math.sqrt( -2.0 * Math.log( u ) ) * Math.cos( 2.0 * Math.PI * v );
	}
function za(a) {//z sub alpha. Uses binary search.
	//if a < .5 WATCH OUT
	var rval = 0;
	for (rval = 0; erf(rval) < (1-a); rval++) {}
	var i = 0;
	var j = 1;
	for (i = 1; i < 20; i++) {
		j = j/2;
		if (erf(rval-j) > (1-a)) {
			rval = rval - j;
			}
		}
	return(rval);
	}
function ran() {
	var result = ribet(0,1);
	var strs = ["Tails","Heads"];
	document.getElementById("result").innerHTML = strs[result];
	document.getElementById("past").innerHTML += strs[result] + "\n";
	trials++;
	total += result;
	var ph = total/trials;
	document.getElementById("stat").innerHTML = "" + total + "/" + trials + " = " + ph;
	var moe = za(.025) * Math.sqrt(ph*(1-ph)/trials);
	document.getElementById("moe").innerHTML = moe;
	//document.getElementById("debug").innerHTML = "(" + za(.05) + "," + za(.025) + "," + za(.005) +")";
	}
function erf(y) {
	if (y < 0) {return(1-erf(-y));}
	if (y == 0) {return(0)};
	var x = y/Math.sqrt(2);
	var a1 = 0.0705230784;
	var a2 = 0.0422820123;
	var a3 = 0.0092705272;
	var a4 = 0.0001520143;
	var a5 = 0.0002765672;
	var a6 = 0.0000430638;
	var p = 1 + a1 * x + a2*x*x + a3*x*x*x + a4*x*x*x*x + a5*x*x*x*x*x + a6*x*x*x*x*x*x;
	p = 1 - 1/Math.pow(p,16);
	return(.5 + .5*p);
	}

var population = [];

function boot() {
	
	}

function generatedata() {
	var n = Number(document.getElementById("np").value);
	var a = Number(document.getElementById("low").value);
	var b = Number(document.getElementById("upp").value);
	var i;
	population = [];
	if (document.getElementById("r1").checked) {
		for (i = 0; i < n; i++) {
			population.push([Math.round(((b-a)*i)/(n-1) + a),0]);
			}
		}
	if (document.getElementById("r2").checked) {
		for (i = 0; i < n; i++) {
			population.push([ribet(a,b),0]);
			}
		}
	if (document.getElementById("r3").checked) {
		for (i = 0; i < n; i++) {
			population.push([Math.round(b*randn_bm() + a),0]);
			}
		}
	document.getElementById("pop").innerHTML = stemandleafstring(population);
	}

function Urad() {
	if (document.getElementById("r3").checked) {
		document.getElementById("lab1").innerHTML = "Mean:";
		document.getElementById("lab2").innerHTML = "Standard Deviation:";
		}
	else {
		document.getElementById("lab1").innerHTML = "Lower Bound:";
		document.getElementById("lab2").innerHTML = "Upper Bound:";
		}
	}

function leaf(n) {
	return(n.toString().slice(-1));
	}
function stem(n) {
	var r = n.toString().slice(0,-1);
	if (r == "") {return("0");}
	if (r == "-") {return("-0");}
	return(r);
	}

function makeleaf(p) {
	var str = leaf(p[0]);
	if (p[1] == 1) {
		str = "<font style='color:white;background-color:black'>" + str + "</font>";
		}
	return(str);
	}

function stemandleafstring(l) {
	var ll = l.slice();
	ll.sort(function(a,b){return(a[0]-b[0]);});
	var str = "";
	var minstem = Math.floor(ll[0][0]/10);
	var maxstem = Math.floor(ll[ll.length-1][0]/10);
	
	var tabl = [];
	var i, j;
	var stemlist = [];
	for (i = 0; i < ll.length; i++) {
		tabl[stem(ll[i][0])] = [];
		if(stemlist.indexOf(stem(ll[i][0])) == -1) {stemlist.push(stem(ll[i][0]))};
		}
	for (i = 0; i < ll.length; i++) {
		tabl[stem(ll[i][0])].push(ll[i]);
		}
	str += "<table border = 1>";
	for (i = 0; i < stemlist.length; i++) {
		str += "<tr> <td>";
		str += stemlist[i];
		str += "</td> <td>";
		for (j = 0; j < tabl[stemlist[i]].length; j++) {
			str += makeleaf(tabl[stemlist[i]][j]);
			}
		str += "</td> </tr>";
		}
	str += "</table>";
	return(str);
	}

function meanie(L) {
	var i = 0;
	var sm = 0;
	for (i = 0; i < L.length; i++) {
		sm += Number(L[i][0]);
		}
	return(sm/L.length);
	}

function mean(L) {
	var i = 0;
	var sm = 0;
	for (i = 0; i < L.length; i++) {
		sm += L[i];
		}
	return(sm/L.length);
	}

function stdevie(L) {
	var i = 0;
	var sm = 0;
	var m = meanie(L);
	var t = 0;
	for (i = 0; i < L.length; i++) {
		t = Number(L[i][0]);
		sm += (t-m)*(t-m);
		}
	return(Math.sqrt(sm/L.length));
	}

function stdev(L) {
	var i = 0;
	var sm = 0;
	var m = mean(L);
	for (i = 0; i < L.length; i++) {
		sm += (L[i]-m)*(L[i]-m);
		}
	return(Math.sqrt(sm/L.length));
	}

function sstdev(L) {
	var i = 0;
	var sm = 0;
	var m = mean(L);
	for (i = 0; i < L.length; i++) {
		sm += (L[i]-m)*(L[i]-m);
		}
	return(Math.sqrt(sm/L.length));
	}

function rounder(n) {
	return(Math.round(n*1000)/1000);
	}

function grounder(n) {
	var r = Math.round(n*10)/10;
	if (r == Math.round(r)) {
		r = r + ".0";
		} 
	return(r);
	}

// if sample size is less than 5% of population, general normal approx work well. if more, need to use another formula
// sample size must be at least 30 for normal approx to work.

var samples = [];
var samplemeans = [];

function sampletable() {
	var str = "<table border = 1>";
	str += "<tr> <td> x&#772; </td> <td> s </td> <td> Sample </td> </tr>";
	var i,j;
	for (i = 0; i < samples.length; i++) {
		str += "<tr><td>";
		str += rounder(mean(samples[i]));
		str += "</td><td>";
		str += rounder(sstdev(samples[i]));
		str += "</td><td>";
		str += samples[i][0];
		for (j = 1; j < samples[i].length; j++) {
			str += ", ";
			str += samples[i][j];
			}
		str += "</td></tr>";
		}
	str += "</table>";
	return(str);
	}

function getsample() {
	var i, t;
	var n = document.getElementById("ns").value;
	var k = population.length-1;
	var samplelist = [];
	for (i = 0; i <= k; i++) {
		population[i][1] = 0;
		}
	for (i = 0; i < n; i++) {
		do {
			t = ribet(0,k);
			} while(population[t][1] > 0);
		population[t][1] = 1;
		samplelist.push(population[t][0]);
		}
	samples.push(samplelist);
	if (samplemeans.length > 0) {
		samplemeans[samplemeans.length-1][1] = 0;
		}
	samplemeans.push([grounder(mean(samplelist)),1]);
	document.getElementById("samples").innerHTML = sampletable();
	document.getElementById("pop").innerHTML = stemandleafstring(population);
	document.getElementById("pop").style.display = 'none';
	document.getElementById("pop").style.display = 'block';
	document.getElementById("ssl").innerHTML = "Sample Means:" + stemandleafstring(samplemeans);
	updatestatstable();
	}

function getmanysample() {
	var n = document.getElementById("nms").value;
	var i;
	for (i = 0; i < n; i++) {
		setTimeout(getsample,i*100);
		}
	}

function updatestatstable() {
	document.getElementById("qam").innerHTML = meanie(population);
	document.getElementById("qbm").innerHTML = samplemeans[samplemeans.length-1][0];
	document.getElementById("qcm").innerHTML = rounder(meanie(samplemeans));
	document.getElementById("qdm").innerHTML = meanie(population);
	document.getElementById("qas").innerHTML = rounder(stdevie(population));
	document.getElementById("qbs").innerHTML = rounder(sstdev(samples[samples.length-1]));
	document.getElementById("qcs").innerHTML = rounder(stdevie(samplemeans));
	document.getElementById("qds").innerHTML = rounder(stdevie(population)/Math.sqrt(document.getElementById("ns").value));
	}

</script>
</head>
<body onload="boot()">
<table border=0> <tr> <td>
<table border=1> <tr> <td>
Population size: <input type='number' id='np' value=1000 style='width:4em'> 
</td> </tr> <tr> <td>
<input id="r1" onchange="Urad()" type="radio" name="radio"> Evenly Spaced <br>
<input id="r2" onchange="Urad()" type="radio" name="radio" checked> Random (Uniform Distribution) <br>
<input id="r3" onchange="Urad()" type="radio" name="radio"> Random (Normal Distribution)
</td> </tr> <tr> <td>
<span id="lab1">Lower bound:</span> <input type='number' id='low' value=0 style='width:3em'> <br>
<span id="lab2">Upper bound:</span> <input type='number' id='upp' value=100 style='width:3em'>
</td> </tr> <tr> <td>
<button onclick="generatedata()">Generate Population</button>
</td> </tr> </table> 
</td> <td>
<table border = 1> <tr> <td>
Sample size: <input type='number' id = 'ns' value=40 style='width:3em'>
</td></tr><tr><td>
<button onclick="getsample()">Generate Sample</button>
</td></tr><tr><td>
Number of Samples: <input type='number' id='nms' value = 100 style='width:3em'> <br>
<button onclick="getmanysample()">Generate Many Samples</button>
</td> </tr> </table> </td> 
<td> <td>
<table border = 1>
<tr> <td> </td> <td> Population </td> <td> Most Recent Sample </td> <td> Sample Means </td> <td> Sample Means (predicted) </td> </tr>
<tr> <td> Mean </td> <td> <div id ="qam"> </div> </td> <td> <div id="qbm"> </div> </td> <td> <div id="qcm"> </td> <td> <div id="qdm"> </td> </tr>
<tr> <td> Standard Deviation </td> <td> <div id ="qas"> </div> </td> <td> <div id="qbs"> </div> </td> <td> <div id="qcs"> </td> <td> <div id="qds"> </td> </tr>
</table> </td>
</tr> </table>
<div id="pop"></div><br>
<div id="ssl"></div><br>
<div id="samples"></div>
</body>
</html>